<!DOCTYPE html>

<html>

    <head>
    <meta charset="UTF-8">
<!-- Élesben nem kell -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script>
// Problem objektum készítése
function createProblem() {
    var problem = new Object();
    problem.status = 'none'; // none, first, second, third
    problem.getScore = function(base_score) {
        switch (this.status) {
            case 'none': return 0;
            case 'first': return base_score;
            case 'second': return base_score-1;
            case 'third': return base_score-2;
            default:
                console.log('Invalid problem state');
                // itt kéne egy rohadtnagy error
        }
    };
    problem.setStatus = function(new_status) {
        switch (this.status) {
            case 'none':
            case 'first':
            case 'second':
            case 'third':
                break;
            default:
                console.log('Invalid problem state. Valid states are none, first, second, third');
                // itt kéne egy rohadtnagy error
        }
        this.status = new_status;
    };
    return problem;
}

// Team objektum készítése
// name: csapatnév
// id: csapatid
function createTeam(name, id=null, num_problems=15) {
    team = new Object();
    var problems = [null]; // 0. feladatot nullal feltöltöm
    for (var i = 1; i <= num_problems; i++)
        problems.push(createProblem());
    team.problems = problems;
    team.teamname = name; // !! nem name, mert azt használhatják kívülről
    team.id = id;
    team.getScore = function(num_problems, base_scores) {
        var sum = 0;
        for (var i = 1; i <= num_problems; i++)
            sum += this.problems[i].getScore(base_scores[i]);
        return sum;
    };
    team.getProblem = function(i) {
        if (i < 1 || i > 15) {
            console.log('ERROR!');
        }
        return this.problems[i];
    }
    return team;
}

// egyszerű teszt Team-re és Problem-re: createTeam, getProblem, problem.setStatus, getScore
function testTeam() {
    var team = createTeam("Szprájt");
    team.getProblem(1).setStatus('first');
    team.getProblem(11).setStatus('second');
    team.getProblem(11).setStatus('second');

    console.log("Test#1: ",
        team.getScore(15, [3,3,3,3,3,4,4,4,4,4,5,5,5,5,5])
    );
}

// globális változók
var base_scores = [3,3,3,3,4,4,4,4,5,5,5,5,6,6,6];
var teams=[];
// teszt, törölj ki
teams.push(createTeam("Hello"));
teams.push(createTeam("Darkness"));
teams.push(createTeam("My"));
teams.push(createTeam("Old"));
teams.push(createTeam("Friend"));

// substring-et keres, nem csak a csapatnév elején
function smartSearchTeam(substr) { // TODO: lowercase
    var num_teams = teams.length;
    var candidates = [];
    for (var i = 0; i < num_teams; i++) {
        var team = teams[i];
        var r = team.teamname.indexOf(substr);
        if (r != -1) {
            candidates.push(team);
        }
    }
    return candidates;
}

// substring-et keres, de csak a csapatnév elején
function searchTeam(substr) { // TODO: lowercase
    var num_teams = len(teams);
    var candidates = [];
    for (var i = 0; i < num_teams; i++) {
        var team = teams[i];
        var r = team.indexOf(substr);
        if (r == 0) {
            candidates.push(team);
        }
    }
    return candidates;
}

function loadTeams() {
    teams = []; // ne írj var-t!
    //teams = ...;
}

function dataOK() {
/*    var teamname = ...;
    var choice = ...;*/
}

testTeam();

// clears all DOM options in DOM select
function clearOptions() {
    $("#teamNames").empty();
    // TODO
}

// add DOM option to DOM select
function addOption(value) {
    $("#teamNames").append($('<option>', {
        value: value,
        text: value
    }));
    // TODO
}

// ha beírok valamit a felső input-ba, akkor a lehetőségek frissülnek az alapján.
function updateOptions() {
    var filtered = smartSearchTeam($("#filter").val());
    var length = filtered.length;
    clearOptions();
    for (var i = 0; i < length; i++) {
        console.log(filtered[i].teamname);
        addOption(filtered[i].teamname);
    }
}

// event callbacks
$(document).ready(function(){
    $("#filter").change(function() {
        console.log("Change");
        updateOptions();
    });
    updateOptions();
});

</script>

<title>Dürer </title>
    </head>
<body>

<!-- Html part -->

<!-- kiszűri azokat a csapatokat, amiknek nincs a nevében az adott szöveg -->
Szűrő: (nyomj entert, TODO) <input type="text" id="filter"><br>
<!-- Itt jelennek meg a megszűrt nevek -->
<select id="teamNames" size="10">
</select><br>

<input type="radio" name="choice" value="first"> 1. Próba<br>

<input type="radio" name="choice" value="second"> 2. Próba<br>

<input type="radio" name="choice" value="third"> 3. Próba<br>

<input type="radio" name="choice" value="pass"> Passz<br>

<input type="button" onclick="dataOK()" value="OKÉ" >

<script>
</script>
</body>

</html>
